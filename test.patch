diff --git a/kernel/events/hw_breakpoint.c b/kernel/events/hw_breakpoint.c
--- a/kernel/events/hw_breakpoint.c
+++ b/kernel/events/hw_breakpoint.c
@@ -33,6 +33,9 @@
 #include <linux/bug.h>
 
 #include <linux/hw_breakpoint.h>
+
+struct mutex hwhook_gate_lock;
+EXPORT_SYMBOL_GPL(hwhook_gate_lock);
+
 /*
  * Constraints data
  */
@@ -449,6 +452,10 @@ register_user_hw_breakpoint(struct perf_event_attr *attr,
 			    perf_overflow_handler_t triggered,
 			    void *context,
 			    struct task_struct *tsk)
 {
+	if (!mutex_is_locked(&hwhook_gate_lock))
+		return ERR_PTR(-EPERM);
+
 	return perf_event_create_kernel_counter(attr, -1, tsk, triggered,
 						context);
 }
@@ -703,6 +709,8 @@ int __init init_hw_breakpoint(void)
 	int cpu, err_cpu;
 	int i;
 
+	mutex_init(&hwhook_gate_lock);
+
 	for (i = 0; i < TYPE_MAX; i++)
 		nr_slots[i] = hw_breakpoint_slots(i);
